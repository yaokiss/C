## c语言的宏定义

```c
#include <stdio.h>

#define N 100

int main(){
int sum = 20 + N;
printf("%d\n",sum);
return 0;
}
```

该示例中的语句int sim = 20 + N;,N被100代替了.

#define N 100 就是宏定义, N为宏名, 100是宏的内容, 对程序中所有出现的'宏名',都用宏定义中的字符串取代换,这称为"宏代换"或"宏展开".


#define 宏名 字符串

宏定义中表达式两边的括号不能少,否则会发生错误.
```c
#include <stdio.h>

#define M (n*n+3*n)

int main(){
    int sum, n;
    printf("Input a number: ");
    scanf("%d", &n);
    sum = 3*M+4*M+5*M;
    printf("sum=%d\n", n);
    return 0;
}

```

## 宏定义的几点说明

1. 宏定义是用宏名来表示一个字符串,在宏展开时又以该字符串取代宏名,这只是简单的替换,字符串中可以含任何字符,可以使常数,可以是表达式,预处理程序对他不做任何检查,如有错误,只能在编译已被宏展开后的源程序时发现.

1. 宏定义不是说明或语句,在航末不必加分号,如果加上分号则连分号也一起替换.

1. 宏定义必须写在函数之外,其作用域为宏定义命令起到原程序结束.如要终止其作用可使用 #undef 命令.例如:
```c
#define PI 3.14159

int main(){
   //code
return 0;
}

#undef PI

void func(){
   //code
}
```

表示PI只在main函数中有效,在func中无效.

1. 宏名在源程序中若引用号括起来.则预处理程序不对其作宏代换,例如:

```c
#include <stdio.h>
#define OK 100
int main(){
printf("OK\n");
return 0;
}
```
运行结果: OK

该例中定义宏名 OK 表示 100.但是在 printf 语句中 OK 被引号括起来了,因此不做宏代换,而作为字符串处理.

1. 宏定义允许嵌套,在宏定义的字符串中可以使用已经定义的宏名,在宏展开时由预处理程序层层代换.例如:

```c
#define PI 3.1415926
#define s PI*y*y    /* PI是已定义的宏名 */
```
对语句:
```c
printf("%f",s);
```
在宏代换后变成:

```c
printf("%f",3.1415926*y*y);
```

1. 习惯上宏名用大写字母表示.以便于与变量区别.但也允许用小写字母.

1. 可以宏定义表示数据类型.使书写方便.例如:

```c
#define UINT unsigned int
```

在程序中可用 UINT 作变量说明:

```c
UINT a, b;
```

**应注意用宏定义表示数据类型和用 typedef 定义数据说明符的区别.宏定义只是简单的字符串代换,是在预处理完成的,而 typedef 实在编译时处理的.它不是作简单的代换,而是对类型说明符重新命名,被命名的标识符具有类型定义说明的功能**

```c
#define PIN1 int *
typedef (int *) PIN2;
```

形式上两者相同,但是在实际使用中却不同.

PIN1,PIN2 说明变量时就可以看出它们的区别:

```c
PIN1 a, b;
```

在宏代换后变成:
```c
int *a, b;
```
表示a是指向整型的指针变量.而b是整型变量.然而:
```c
PIN2 a, b;
```

表示a, b都是指向整型的指针变量,因为PINT2是一个类型说明符,**宏定义虽然也可表达数据类型.但毕竟是作字符代换.在使用时要分外小心,避免出错**























